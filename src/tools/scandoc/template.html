<<
# Scandoc template file. (XOpen(tm) look and feel)
# ======================================================================
# For quick and superficial customization, simply change these variables
$project_name = 'TORCS';
$company_logo = '<img src=../../img/logo-nvvs.png border=0>';            # change this to an image tag.
$copyright = '&copy 1999 Eric Espie';
$image_directory = "../../img/";
$index_background = $image_directory . "slate.jpg";
$page_background  = $image_directory . "greytile.jpg";
$bullet1_image = $image_directory . "ball1.gif";
$bullet2_image = $image_directory . "ball2.gif";
# ======================================================================
# Begin generating frame index file.
file "index.html";
>><html>
<head>
<title>$project_name -- Index</title>
<BODY BGCOLOR="#FFFFFF" TEXT=#000000 LINK=#0020ff VLINK=#0020ff>
</head>
<body>

<table width=100% border=0>
  <tr>
    <td align=left>$company_logo</td>
    <td align=center><font size="6"><b>Project $project_name</b></font></td>
    <td align=right>$company_logo</td>
  </tr>
</table>

<hr size=2 noshade>
<center><code>
<p>
<<
# For each package, generate an index entry.
foreach $p (packages()) {
	>><p><b>---------- <a href="$(p.url)">$(p.name)</a> ----------</b>
	<<
	if ($p->classes()) { >><p><b>Classes</b><p><< };
	foreach $e ($p->classes()) {
		>>&#183; <a href="$(e.url)">$(e.fullname)</a>
		<<
	}
	if ($p->classes()) { >> &#183; << };
	if ($p->globalfuncs()) { >><p><b>Functions</b><p><< };
	foreach $e ($p->globalfuncs()) {
		>>&#183; <a href="$(e.url)">$(e.longname)</a>
		<<
	}
	if ($p->globalfuncs()) { >> &#183; << };
	if ($p->globalvars()) { >><p><b>Variables</b><p><< };
	foreach $e ($p->globalvars()) {
		>>&#183; <a href="$(e.url)">$(e.longname)</a>
		<<
	}
	if ($p->globalvars()) { >> &#183; << };
}
>><p>
<a href="to-do.html" target="Documentation"><b>To-Do List</b></a><p>
</code>
<hr size=2 noshade>

$copyright<br>Generated by <a href="http://www.sylvantech.com/~talin/projects/scandoc/scandoc.html"><b>ScanDoc</b></a><br>
Last Updated: $date<br>
<hr size=2 noshade>
</center>
</body>
</html>
<<

# =========================================
# Generate "To-do list"

file "to-do.html";
>><html>

<head>
<title>$project_name -- To-Do list</title>
<BODY  BGCOLOR="#FFFFFF" TEXT=#000000 LINK=#0020ff VLINK=#0020ff>
</head>
<body>

<table width=100% border=0>
  <tr>
    <td align=left>$company_logo</td>
    <td align=center><font size="6"><b>To-do list for $project_name</b></font></td>
    <td align=right>$company_logo</td>
  </tr>
</table>

<hr size=2 noshade>

<<
if (&todolist_files()) {
	>><p>
	<<
	foreach $f (&todolist_files()) {
		my @m = &todolist_entries( $f );
		if ($f =~ /([^\/]+)$/) { $f = $1; }
		>><b>$f:</b><ul>
		<<
		foreach $text (@m) {
			if ($text)
			{
				print "<li>", &processDescription( $text ), "\n";
			}
		}
		>></ul>
		<<
	}
}
>>
<hr size=2 noshade>
<center>
$copyright<br>
Generated by <a href="http://www.sylvantech.com/~talin/projects/scandoc/scandoc.html"><b>ScanDoc</b></a><br>
Last Updated: $date<br>
|<a href="index.html">index</a>|<br>
<hr size=2 noshade>
</center>
</body>
</html>

<<

# ==============================================
# Begin generating index file for each package.
my $p;
foreach $p (packages()) {
	file $p->name() . ".html";
>><html>
<head>
<title>$project_name -- $(p.name)</title>
<BODY  BGCOLOR="#FFFFFF" TEXT=#000000 LINK=#0020ff VLINK=#0020ff>
</head>
<body>

<table width=100% border=0>
  <tr>
    <td align=left>$company_logo</td>
    <td align=center><font size="6"><b>$project_name - $(p.name)</b></font></td>
    <td align=right>$company_logo</td>
  </tr>
</table>

<hr size=2 noshade>
<<
# Output info
if ($p->packinfo()) {
	>><dl><dd>$(p.packinfo)<p></dl><hr size=2 noshade><<
}
>>
<center><code>
<<
	>><p><b>---------- $(p.name) ----------</b>
	<<
	if ($p->classes()) { >><p><b>Classes</b><p><< };
	foreach $e ($p->classes()) {
		>>&#183; <a href="$(e.url)">$(e.fullname)</a>
		<<
	}
	if ($p->classes()) { >> &#183; << };
	if ($p->globalfuncs()) { >><p><b>Functions</b><p><< };
	foreach $e ($p->globalfuncs()) {
		>>&#183; <a href="$(e.url)">$(e.longname)</a>
		<<
	}
	if ($p->globalfuncs()) { >> &#183; << };
	if ($p->globalvars()) { >><p><b>Variables</b><p><< };
	foreach $e ($p->globalvars()) {
		>>&#183; <a href="$(e.url)">$(e.longname)</a>
		<<
	}
	if ($p->globalvars()) { >> &#183; << };
>></code>
<p>
<hr size=2 noshade>
$copyright<br>
Generated by <a href="http://www.sylvantech.com/~talin/projects/scandoc/scandoc.html"><b>ScanDoc</b></a><br>
Last Updated: $date<br>
|<a href="index.html">Index</a>|<a href="to-do.html">To-Do List</a>|<br>
<hr size=2 noshade>
</center>
</body>
</html>
<<
}

# ============================================
# Generate individual files for each function.
foreach $p (packages()) {
    # Output global functions
    foreach $m ($p->globalfuncs()) {
      file $m->url();
>><html>
<head>
<title>$project_name -- $(p.name)</title>
<BODY  BGCOLOR="#FFFFFF" TEXT=#000000 LINK=#0020ff VLINK=#0020ff>
</head>
<body>

<table width=100% border=0>
  <tr>
    <td align=left>$company_logo</td>
    <td align=center><font size="6"><b>$project_name - $(p.name)</b></font></td>
    <td align=right>$company_logo</td>
  </tr>
</table>
<hr size=2 noshade>
<<

          &function( $m ); 
>>
<p><center>
<hr size=2 noshade>
$copyright<br>
Generated by <a href="http://www.sylvantech.com/~talin/projects/scandoc/scandoc.html"><b>ScanDoc</b></a><br>
Last Updated: $date<br>
|<a href="index.html">Index</a>|<a href="to-do.html">To-Do List</a>|<br>
<hr size=2 noshade>
</center>
</body>
</html>
<<
    }
}

# ============================================
# Generate individual files for each variable.
foreach $p (packages()) {
    # Output global functions
	foreach $m ($p->globalvars()) {
          file $m->url();
>><html>
<head>
<title>$project_name -- $(p.name)</title>
<BODY  BGCOLOR="#FFFFFF" TEXT=#000000 LINK=#0020ff VLINK=#0020ff>
</head>
<body>

<table width=100% border=0>
  <tr>
    <td align=left>$company_logo</td>
    <td align=center><font size="6"><b>$project_name - $(p.name)</b></font></td>
    <td align=right>$company_logo</td>
  </tr>
</table>
<hr size=2 noshade>
<<

          &variable( $m ); 
>>
<p><center>
<hr size=2 noshade>
$copyright<br>
Generated by <a href="http://www.sylvantech.com/~talin/projects/scandoc/scandoc.html"><b>ScanDoc</b></a><br>
Last Updated: $date<br>
|<a href="index.html">Index</a>|<a href="to-do.html">To-Do List</a>|<br>
<hr size=2 noshade>
</center>
</body>
</html>
<<
    }
}



# Subroutine to generate documentation for a member function or global function
sub function {
	local ($f) = @_;

	if ($f->keywords()) {
		>><!-- $(f.keywords) -->
		<<
	}

	>>
	<dl>
	<dt>
	<h4>FUNCTION NAME</h4>
        <dd>$(f.longname)
	<p>
	<dt><h4>SYNOPSIS</h4>
	<dd><tt>$(f.fullname);</tt><p>
	<<
	# Output Source file
	if ($f->sourcefile()) {
		>><dt><h4>SOURCE</h4><dd>src/$(f.sourcefile)<p><<
	}
	>>
	<dt><h4>DESCRIPTION</h4><dd>
	<<
	print &processDescription( $f->description() );
        >><p>
	<<
	if ($f->params()) {
		>>
		<dt><h4>PARAMETERS</h4><dd>
		<dl compact>
		<<
		foreach $a ($f->params()) {
			>>
			<dt><b>$(a.name)</b><br><dd>
                        <<
			print &processDescription( $a->description() );
		}
		>>
		</dl>
                <p>
		<<
	}
	
	if ($f->returnval()) {
		>><dt><h4>RETURN</h4><dd><<
		print &processDescription( $f->returnval() );
                >><p><<
	}
	
	if ($f->exceptions()) {
		>><dt><h4>ERRORS</h4><dd>
		<dl compact>
		<<
		foreach $a ($f->exceptions()) {
			>>
			<dt><b>$(a.name)</b><br><dd><<
			print &processDescription( $a->description() );
		}
		>></dl><p>
		<<
	}
	
	if ($f->seealso()) {
		>><dt><h4>SEE ALSO</h4><dd>
		<<
		my @r = ();
		foreach $a ($f->seealso()) {
			my $name = $a->name();
			if ($url = $a->url()) {
				push @r, "<a href=\"$url\">$name</a>";
			}
			else { push @r, $name; }
		}
		print join( ',', @r );
		>><p>
		<<
	}
	>></dl>
	<<
}

# Subroutine to generate documentation for a member variable or global variable.
sub variable {
	local ($v) = @_;

	if ($v->keywords()) {
		print "<!-- $(v.keywords) -->";
	}

	>>
	<dl>
	<dt>
	<h4>VARIABLE NAME</h4>
        <dd>$(v.longname)
	<p>
	<dt><h4>SYNOPSIS</h4>
	<dd><tt><font size=2>$(v.fullname);</font></tt><p>
	<<
	# Output Source file
	if ($v->sourcefile()) {
		>><dt><h4>SOURCE</h4><dd>$(v.sourcefile)<p><<
	}
	>>
	<dt><h4>DESCRIPTION</h4><dd>
	<<
	print &processDescription( $v->description() );
        >><p>
	<<
	
	if ($v->seealso()) {
		>><dt><h4>SEE ALSO</h4><dd>
		<<
		my @r = ();
		foreach $a ($v->seealso()) {
			my $name = $a->name();
			if ($url = $a->url()) {
				push @r, "<a href=\"$url\">$name</a>";
			}
			else { push @r, $name; }
		}
		print join( ',', @r );
		>><p>
		<<
	}
	>></dl>
	<<
}

sub processDescription {
    local ($_) = @_;
	
    s/^\s+//;				# Remove whitespace from beginning
    s/\s+$/\n/;				# Remove whitespace from end
    s/\n\n/<p>\n/g;			# Replace multiple CR's with paragraph markers
    s/\n/<br>\n/g;			# Replace single CR with break markers
    s:\@heading(.*)\n:<p><h4>$1</h4>:;	# Handle heading text

    # Handle embedded image tags
    s:\@caution:<p><img src=\"${image_directory}/caution.gif\" align=left>:;
    s:\@warning:<p><img src=\"${image_directory}/warning.gif\" align=left>:;
    s:\@bug:<p><img src=\"${image_directory}/bug.gif\" align=left>:;
    s:\@tip:<p><img src=\"${image_directory}/tip.gif\" align=left>:;

    return $_;
}
